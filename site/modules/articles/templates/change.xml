<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document SYSTEM "../../../units/schema/template.dtd">
<document>
	<form action="$params['form_action']" cms:eval="action" method="POST" id="article_change_form">
		<div id="article_write_notebook">
			<div>
				<label>
					<input type="hidden" name="id" value="$params['id']" cms:eval="value"/>
					<span><cms:text constant="label_text_id" module="articles"/></span>
					<input type="text" name="text_id" class="code" value="$params['text_id']" cms:eval="value" style="width: 270px;" maxlength="32"/>
				</label>
				<label class="horizontal">
					<span><cms:text constant="label_group" module="articles"/></span>
					<select name="group" style="width: 270px;">
						<option></option>
						<cms:group_list template="group_option.xml" local="1" selected="$params['group']" cms:eval="selected"/>
					</select>
				</label>
				<label class="horizontal">
					<span><cms:text constant="label_gallery" module="articles"/></span>
					<select name="gallery">
						<option></option>
						<cms:gallery_list
							template="groups_option.xml"
							selected="$params['gallery']"
							cms:eval="selected"
							local="1"
							/>
					</select>
				</label>
				<label>
					<span><cms:text constant="label_title" module="articles"/></span>
					<input type="text" class="multi-language" name="title" style="width: 400px;" maxlength="255"/>
					<cms:language_data param="title"/>
				</label>
				<label class="checkbox">
					<span><cms:text constant="label_visible" module="articles"/></span>
					<input
						type="checkbox"
						name="visible"
						checked="$params['visible'] ? 'checked' : false"
						cms:optional="checked"
						/>
				</label>
			</div>
			<div>
				<label>
					<span><cms:text constant="label_content" module="articles"/></span>
					<textarea
						class="multi-language code"
						name="content"
						rows="5"
						cols="40"
						style="width: 685px; height: 250px;"
						/>
					<cms:language_data param="content"/>
				</label>
			</div>
			<div>
				<div class="markdown_preview" id="article_preview"/>
			</div>
		</div>
		<div class="button_bar">
			<button type="submit"><cms:text constant="save"/></button>
			<button type="reset"><cms:text constant="reset"/></button>
			<button type="button" onclick="$params['cancel_action']" cms:eval="onclick">
				<cms:text constant="cancel"/>
			</button>
		</div>
	</form>
	<script type="text/javascript">
		new LanguageSelector('article_change_form');
		var converter = new Showdown.converter();

		// create toolbar
		toolbar_api
				.createToolbar('article_change_form', '[name=content]:input')
				.addControl('common', 'markdown')
				.addControl('gallery', 'article_image')
				.addControl('downloads', 'link');

		// create notebook
		var notebook = new Notebook('article_write_notebook');
		notebook
			.setPageTitle(0, language_handler.getText('articles', 'tab_general'))
			.setPageTitle(1, language_handler.getText('articles', 'tab_content'))
			.setPageTitle(2, language_handler.getText('articles', 'tab_preview'));

		// update preview on blur
		$('div#article_write_notebook textarea[name=content]').blur(function() {
			var preview = $('div#article_preview');
			preview.html(converter.makeHtml($(this).val()));
		});

	</script>

</document>
